## 📚 오늘 배운 내용

---

# ElasticSearch

---

모든 검색엔진의 시초인 루씬(Lucene)을 기반으로 한 검색 엔진으로 현 시점 가장 사용량이 많다.

# ES(ElasticSearch)와 RDBMS 비교

### 데이터 구조

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fbf49754-ca06-4f56-a32a-0034085f1b47/Untitled.png)

### Method

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/87aa6d1a-5927-424c-ae4f-ab18b6a23daa/Untitled.png)

# 역색인

일반적인 색인 전략과 다르게, 문서 내의 문자와 같은 내용물의 매핑 정보를 색인하는 것.
기존 색인을 책의 목차라고 가정한다면, 역색인은 책의 맨 뒤에 있는 단어별 색인 페이지로 이해할 수 있다.

# 특징

- NoSQL의 일종으로 분류할 수 있다.
- 분산처리를 통해 실시간 빠른 검색이 가능.
- 기존 데이터로 처리하기 힘든 대량의 비정형 데이터 검색 가능
- 전문 검색과 구조 검색 모두를 지원
- MongoDB같은 대용량 스토리지로도 활용 가능

# 장점

- 오픈소스 검색 엔진이다.
- 전문검색(Full Text)
    - 내용 전체를 색인하여 특정 단어가 포함된 문서를 검색할 수 있다.
    - 기능별, 언어별 플러그인을 적용할 수 있다.
- 통계 분석
    - 비정형 로그 데이터를 수집하여 통계 분석에 활용할 수 있다.
    - Kibana를 연결하면 실시간으로 로그를 분석하고, 시각화 할 수 있다.
- Schemaless
    - 정형화되지 않은 문서도 자동으로 색인하고 검색할 수 있다.
- Multi-tenancy
    - 서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러 인덱스를 한번에 조회할 수 있다.
- Document-Oriented
    - 여러 계층 구조의 문서로 저장이 가능하며, 계층 구조로된 문서도 한번의 쿼리로 쉽게 조회할 수 있다.
- RESTful API
    - 데이터 조회, 입력, 삭제를 HTTP 프로토콜을 통해 RESTful API로 처리합니다.
- 역색인(Inverted Index)
- 확장성
    - 분산 구성이 가능하다. 분산 환경에서 데이터는 shard라는 단위로 나뉜다.

# 단점

- 완전 실시간은 아니다.
    - 색인된 데이터는 1초 뒤에나 검색이 가능하다. 내부적으로 commit, flush 같은 과정이 필요하기 때문.
- Transaction Rollback을 지원하지 않는다.
    - 전체적인 클러스터 성능 향상을 위해 시스템적으로 비용 소모가 큰 롤백과 트랜잭션을 지원하지 않는다.
- 데이터의 업데이트를 제공하지 않는다.
    - 업데이트 명령이 올 경우, 기존 문서를 삭제하고 새로운 문서를 생성한다.
    - 업데이트에 비해서 많은 비용이 들겠지만, 이를 통해 불변성을 보장한다.

# 인덱스(Index)와 샤드(Shard)

- ES는 단일 데이터 단위를 Document라고 칭하며, 이들의 집합을 Index라고 한다.
- Index가 여러 뜻으로 사용되기 때문에, 데이터 저장 단위인 Index는 Indices라고 표현하기도 한다.
- 인덱스는 기본적으로 샤드(Shard)라는 단위로 분리되고, 각 노드에 분산되어 저장된다.

### 프라이머리 샤드(Primary Shard)

- 인덱스를 별도 설정 없이 생성하면 샤드 1개로 구성된다.(7.0 이상)
- 클러스터에 노드를 추가하게 되면, 샤드들이 각 노드로 분산되고, 디폴트로 1개의 복제본 생성
    - 프라이머리 샤드: 처음 생성된 샤드
    - 리플리카: 복제 생성된 샤드
    

# 클러스터와 노드 바인딩

- ES는 클러스터로 이루어지며, 노드가 한개여도 동일하다.
- 노드를 동일한 이름의 클러스터로 생성했을 때 서로 바인딩 된다.

### 디스커버리

- 노드가 처음 실행될 때 같은 서버 또는 네트워크 상의 다른 노드를 찾아 하나의 클러스터로 바인딩하는 과정