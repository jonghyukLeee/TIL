# JPA 2차 캐시

### 기본 정보
- JPA는 1차 캐시라고 불리는 영속성 컨텍스트뿐만 아니라 2차 캐시라는 공간도 존재함
- 2차캐시는 평소에는 동작하지 않지만, Entity 단위로 @Cacheable을 붙이거나, 별도 설정을 하면 사용할 수 있음.

### 2차캐시의 역할
- Entity 조회 시 영속성 컨텍스트 (1차 캐시)에 캐싱된 데이터가 없다면, 1차 캐시는 2차 캐시에서 값을 찾는다.
    - 그래도 없으면 DB 조회

### 기타 특징
- 1차 캐시는 트랜잭션 단위에서 동작하지만, 2차 캐시는 애플리케이션 단위이기 때문에 보다 광범위하게 활용될 수 있다.
- JVM 힙 영역에 적재되므로 적절한 상황에서의 활용이 필요하다.
- 2차 캐시는 db 자원을 효율적으로 활용하기 위해 엔티티 매니저로 부터 최초 쿼리가 요청되는 시점에서 db 커넥션을 얻어온다.
    - 커넥션 종료 시점
        - 엔티티 매니저가 db 커넥션을 반환
        - 트랜잭션 종료
        - 애플리케이션 종료
    - 따라서, db 커넥션을 너무 오래 점유하지 않도록 반환하는 시점을 잘 설계하는 것도 중요한 듯

### 추가로 알게된것
- OSIV는 API 요청 단위로 커넥션이 유지됨 